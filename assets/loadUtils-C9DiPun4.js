import{hT as z,lS as g,lT as S,b6 as $,lU as k,lV as y,bg as I}from"./index-D7KyvF9D.js";import{f as T}from"./dataUtils-A60O1_b2.js";import{h as A}from"./FeatureTileDescriptor-DePkjRqs.js";class B{constructor(e,t,o,i,l){this.extent=e,this.timeExtent=t,this.size=o,this.pixelRatio=i,this.time=l}get flowExtentInfo(){return{modelSize:this.size,valid:$(this.extent.spatialReference)?.valid,extent:S(this.extent)}}insideMapExtent(e,t){return j(this.flowExtentInfo,e,t)}modelToMapSpace(e,t,o){return v(this.flowExtentInfo,e,t,o)}}function j(n,e,t){const{extent:o,valid:i}=n,[l,u,r,s]=o;return!(t<u||t>s)&&(i!=null&&l>r?e>=r||e<=l:e>=l&&e<=r)}function v(n,e,t,o){const{extent:i,modelSize:l,valid:u}=n,[r,s,c]=i,f=F(r,c,u);let a=e/l[0]*f+r;return u!=null&&o&&(a=new z(u[0],u[1]).normalize(a)),[a,(l[1]-t)/l[1]*g(i)+s]}function R(n,e,t){return t!=null&&Math.abs(n-t.valid[0])<t.dx&&Math.abs(e-t.valid[1])<t.dx}function F(n,e,t){if(t!=null&&n>e){const[o,i]=t;return i-n+(e-o)}return e-n}function C(n){return n?4:3}function D(n){return n[0].vertices instanceof Float32Array}class H{constructor(e,t,o,i,l,u){this.data=e,this.mask=t,this.width=o,this.height=i,this.lij=l,this.extent=u}}function J(n){return A(n.lij[0],n.lij[1],n.lij[2])}function K(n,e){let[t,o,i,l]=[null,null,null,null];for(const u of n){const r=u.extent;t=b(r[0],t),o=b(r[1],o),i=w(r[2],i),l=w(r[3],l)}if(t==null||o==null||i==null||l==null)return null;if(R(t,i,e)){const u=[...n].toSorted((a,h)=>a.extent[0]-h.extent[0]);let r=u[0].extent[2],s=0,c=0,f=0;for(let a=1;a<u.length;a++){const[h,x,d]=u[a].extent;if(r<h&&(f++,s=r,c=h,f>1))break;r=Math.max(r,d)}f===1&&(t=c,i=s)}return I([t,o,i,l])}function w(n,e){return e==null?n:Math.max(n,e)}function b(n,e){return e==null?n:Math.min(n,e)}function L(n,e,t){const[o,i]=t.modelSize;let l=null;const u=new Map;e.forEach(s=>{u.set(s.lij,T(n,s))});const r=(s,c,f)=>y(s.extent,c,f);return(s,c)=>{const f=Math.round(s),a=Math.round(c);if(!n.wrapAround&&(f<0||f>=o||a<0||a>=i))return[0,0];const[h,x]=v(t,s,c,!0);if(!j(t,h,x))return[0,0];if(l==null||!r(l,h,x)){l=null;for(const[G,M]of e)if(r(M,h,x)){l=M;break}}if(l?.data==null)return[0,0];const d=u.get(l.lij);if(d==null)return[0,0];const{width:E,height:p,extent:m}=l;return d((h-m[0])/k(m)*E,p-(x-m[1])/g(m)*p)}}export{D as a,F as b,H as c,C as f,J as h,K as m,B as o,R as s,L as x};
