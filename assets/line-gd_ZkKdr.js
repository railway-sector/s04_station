import{kW as g,kX as D,kY as F,kZ as d,k_ as p,k$ as A,cj as w,cw as v,l0 as z,l1 as S,l2 as m,l3 as $,f8 as y}from"./index-D7KyvF9D.js";function E(t,e=!1){return t<=g?e?new Array(t).fill(0):new Array(t):D(t)}function Z(t,e,r=null){const n=[],a=e.mapPositions,o=k(e,n),i=o.data,s=o.indices.length,u=F(s);return I(e,n,u),G(e,n,u),j(e,n,u),x(e,n,o.indices,u),R(e,n,o.indices,u),T(e,n),C(e,n,o.indices,u),H(e,n,i),new d(t,n,a,2,r)}function k(t,e){const{attributeData:{position:r},removeDuplicateStartEnd:n}=t,a=M(r)&&n,o=r.length/3-(a?1:0),i=new Array(2*(o-1)),s=a?r.slice(0,-3):r;let u=0;for(let l=0;l<o-1;l++)i[u++]=l,i[u++]=l+1;const c=new p(s,i,3,a);return e.push(["position",c]),c}function I(t,e,r){if(t.attributeData.colorFeature!=null)return;const n=t.attributeData.color;e.push(["color",new p(n??A,r,4)])}function j(t,e,r){t.attributeData.normal&&e.push(["normal",new p(t.attributeData.normal,r,3)])}function x(t,e,r,n){const a=t.attributeData.colorFeature;a!=null&&(typeof a=="number"?e.push(["colorFeatureAttribute",new p([a],n,1,!0)]):e.push(["colorFeatureAttribute",new p(a,r,1,!0)]))}function G(t,e,r){t.attributeData.sizeFeature==null&&e.push(["size",new p([t.attributeData.size??1],r,1,!0)])}function R(t,e,r,n){const a=t.attributeData.sizeFeature;a!=null&&(typeof a=="number"?e.push(["sizeFeatureAttribute",new p([a],n,1,!0)]):e.push(["sizeFeatureAttribute",new p(a,r,1,!0)]))}function T(t,e){const{attributeData:{position:r,timeStamps:n}}=t;if(!n)return;const a=r.length/3,o=new Array(2*(a-1));let i=0;for(let s=0;s<a-1;s++)o[i++]=s,o[i++]=s+1;e.push(["timeStamps",new p(n,o,h,!0)])}function C(t,e,r,n){const a=t.attributeData.opacityFeature;a!=null&&(typeof a=="number"?e.push(["opacityFeatureAttribute",new p([a],n,1,!0)]):e.push(["opacityFeatureAttribute",new p(a,r,1,!0)]))}function H(t,e,r){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==1||!t.overlayInfo.spatialReference.isGeographic)return;const n=w(r.length),a=v(t.overlayInfo.spatialReference);for(let f=0;f<n.length;f+=3)z(r,f,n,f,a);const o=r.length/3,i=S(o+1);let s=P,u=U,c=0,l=0;m(s,n[l++],n[l++]),l++,i[0]=0;for(let f=1;f<o+1;++f)f===o&&(l=0),m(u,n[l++],n[l++]),l++,c+=$(s,u),i[f]=c,[s,u]=[u,s];e.push(["distanceToStart",new p(i,e[0][1].indices,1,!0)])}function M(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const P=y(),U=y(),h=4;function W(t,e,r,n,a){if(t==null||t.length===0)return[];const o=[];return t.forEach((i,s)=>{const u=i.length,c=w(3*u);i.forEach((f,b)=>{c[3*b]=f[0],c[3*b+1]=f[1],c[3*b+2]=f[2]});const l={attributeData:{position:c,normal:e,colorFeature:r?.[s],opacityFeature:n?.[s],sizeFeature:a?.[s]},removeDuplicateStartEnd:!1};o.push(l)}),o}function _(t,e,r,n,a,o){if(t==null||t.length===0)return[];const i=W(t,e,n,a,o);return t.forEach((s,u)=>{const c=r?.[u],l=c!=null?X(c.timeStamps,c.streamlineType):void 0;i[u].attributeData.timeStamps=l}),i}function X(t,e){const r=E(t.length*h),n=t[0],a=t[t.length-1];for(let o=0;o<t.length;o++)r[o*h]=t[o],r[o*h+1]=n,r[o*h+2]=a,r[o*h+3]=e+.5;return r}export{_ as E,W as S,Z as f,E as n};
